name: Manage Develop to Main

on:
  push:
    branches:
      - develop # Tá»± Ä‘á»™ng kiá»ƒm tra xung Ä‘á»™t khi develop thay Ä‘á»•i
  workflow_dispatch: # Cho phÃ©p merge thá»§ cÃ´ng qua nÃºt "Run workflow"
    inputs:
      target_branch:
        description: "Target branch to merge into"
        required: true
        default: "main"

jobs:
  check-conflict:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      # 1. Clone repository
      - name: ğŸ› ï¸ Checkout Repository ğŸ› ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Cáº¥u hÃ¬nh Git
      - name: âš™ï¸ Configure Git âš™ï¸
        run: |
          git config user.name "MinhHien39"
          git config user.email "tranminhhien06072001@gmail.com"

      # 3. Kiá»ƒm tra xung Ä‘á»™t
      - name: ğŸ” Check for Merge Conflicts
        id: check-conflict
        run: |
          git fetch origin main
          git fetch origin develop
          git checkout main
          git merge --no-commit --no-ff develop || echo "::set-output name=conflict::true"
        continue-on-error: true

      # 4. ThÃ´ng bÃ¡o tráº¡ng thÃ¡i
      - name: ğŸš€ Show Merge Status
        run: |
          if [[ "${{ steps.check-conflict.outputs.conflict }}" == "true" ]]; then
            echo "âŒ Conflict detected between develop and main. Please fix conflicts."
            exit 1
          else
            echo "âœ… No conflict detected. You can manually merge develop into main."
          fi

  manual-merge:
    if: github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      # 1. Clone repository
      - name: ğŸ› ï¸ Checkout Repository ğŸ› ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Cáº¥u hÃ¬nh Git
      - name: âš™ï¸ Configure Git âš™ï¸
        run: |
          git config user.name "YourUsername"
          git config user.email "your.email@example.com"

      # 3. Merge develop vÃ o main
      - name: âœ… Manual Merge Develop into Main âœ…
        run: |
          git checkout ${{ github.event.inputs.target_branch }}
          git merge develop --no-ff -m "Manual merge from develop to ${{ github.event.inputs.target_branch }}"
          git push origin ${{ github.event.inputs.target_branch }}
