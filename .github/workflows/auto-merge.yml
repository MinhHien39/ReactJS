name: Manual Merge Develop to Main

on:
  workflow_dispatch: # KÃ­ch hoáº¡t khi nháº¥n nÃºt "Run workflow"
    inputs:
      target_branch:
        description: "Target branch to merge into"
        required: true
        default: "main"

jobs:
  check-and-merge:
    runs-on: ubuntu-latest
    steps:
      # 1. Clone repository
      - name: ğŸ› ï¸ Checkout Repository ğŸ› ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Cáº¥u hÃ¬nh Git
      - name: âš™ï¸ Configure Git âš™ï¸
        run: |
          git config user.name "MinhHien39"
          git config user.email "tranminhhien06072001@gmail.com"

      # 3. Kiá»ƒm tra xung Ä‘á»™t
      - name: ğŸ” Check for Merge Conflicts
        id: check-conflict
        run: |
          git fetch origin ${{ github.event.inputs.target_branch }}
          git fetch origin develop
          git checkout ${{ github.event.inputs.target_branch }}
          git merge --no-commit --no-ff develop || echo "::set-output name=conflict::true"
        continue-on-error: true

      # 4. Hiá»ƒn thá»‹ lá»—i náº¿u cÃ³ conflict
      - name: âŒ Handle Conflict
        if: steps.check-conflict.outputs.conflict == 'true'
        run: |
          echo "âŒ Merge conflict detected! Please resolve conflicts manually."
          exit 1

      # 5. Merge develop vÃ o main náº¿u khÃ´ng cÃ³ conflict
      - name: âœ… Manual Merge Develop into Main âœ…
        if: steps.check-conflict.outputs.conflict != 'true'
        run: |
          git checkout ${{ github.event.inputs.target_branch }}
          git merge develop --no-ff -m "Manual merge from develop to ${{ github.event.inputs.target_branch }}"
          git push origin ${{ github.event.inputs.target_branch }}
