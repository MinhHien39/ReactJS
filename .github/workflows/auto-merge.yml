name: Auto Merge Develop to Main with Manual Trigger

on:
  push:
    branches:
      - develop # KÃ­ch hoáº¡t khi cÃ³ thay Ä‘á»•i trÃªn nhÃ¡nh develop
  workflow_dispatch: # Cho phÃ©p trigger thá»§ cÃ´ng Ä‘á»ƒ merge

jobs:
  check-conflict:
    runs-on: ubuntu-latest
    steps:
      # 1. Clone repository
      - name: ğŸ› ï¸ Checkout Repository ğŸ› ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Kiá»ƒm tra conflict giá»¯a main vÃ  develop
      - name: ğŸ”€ Attempt Merge Main into Develop (Dry Run)
        id: check-merge
        run: |
          git fetch origin
          git checkout main
          git merge --no-commit --no-ff develop || echo "::set-output name=conflict::true"
        continue-on-error: true

      - name: ğŸ” Check for Merge Conflicts
        if: steps.check-merge.outputs.conflict == 'true'
        run: |
          echo "âŒ Merge conflict detected! Please resolve conflicts manually."
          exit 1

      - name: âœ… No Conflict Detected
        if: success()
        run: echo "âœ… No conflict detected. Ready for manual merge."

  manual-merge:
    runs-on: ubuntu-latest
    needs: check-conflict
    steps:
      # 1. Clone repository
      - name: ğŸ› ï¸ Checkout Repository ğŸ› ï¸
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # 2. Cáº¥u hÃ¬nh Git
      - name: âš™ï¸ Configure Git âš™ï¸
        env:
          GIT_USER_NAME: ${{ secrets.GIT_USER_NAME }}
          GIT_USER_EMAIL: ${{ secrets.GIT_USER_EMAIL }}
        run: |
          git config user.name "$GIT_USER_NAME"
          git config user.email "$GIT_USER_EMAIL"

      # 3. Merge develop vÃ o main
      - name: âœ… Merge Develop into Main âœ…
        run: |
          git checkout main
          git merge develop --no-ff -m "Manual merge from develop to main"
          git push origin main
